"use strict";function emptyOrderListTable(){$("#orders-table tbody").empty()}function showOrderListTable(n){emptyOrderListTable();n.forEach(function(n){if(n){var t="<tr>"+("<td>"+n+"<\/td>")+"<\/tr>";$("#orders-table tbody").append(t)}})}function searchTrailer(n){$.get("/api/ApiGeneral/SearchExistingTrailer?TrailerId="+n,function(n){var i=0,r=[],t;if(n.length==0){customAlert("Not Found Trailer");CurrentTrailerId=null;$("#trailer-id").html("Not Found");return}for(t=0;t<n.length;t++)i=n[t].trailerId,r.push(n[t].orderNumber);$("#trailer-id").html(i);showOrderListTable(r);CurrentTrailerId=i})}function GeneratePDFFromInvoice(n){for(var k,u,w,e,v,tt,h,b=595,y=842,t=new jsPDF("portrait","pt","a4"),s=0;s<n.length;s++){t.setPage(t.internal.getNumberOfPages());t.setFont("arial","italic");t.setFontSize(18);t.text(400,30,"Commercial Invoice");t.setDrawColor(0,0,0);t.setLineWidth(1);t.line(20,50,b-20,50);var i=n[s].invoiceHeader,o=n[s].invoiceDetails,f=n[s].invoiceFooter,c=i.sellerAddress1+"  "+i.sellerAddress2+"  "+i.sellerAddress3+"  "+(i.sellerCityOrTown+"  "+i.sellerStateProvinceCounty+"  "+i.sellerPostalCode+"  "+i.sellerCountry),l=i.importerAddress1+"  "+i.importerAddress2+"  "+i.importerAddress3+"  "+(i.importerCityOrTown+"  "+i.importerStateProvinceCounty+"  "+i.importerPostalCode+"  "+i.importerCountry),a=i.customerAddress1+"  "+i.customerAddress2+"  "+i.customerAddress3+"  "+(i.customerCity+"  "+i.customerPostalCode+"  "+i.customerCountry),r=80;c.length>r&&(c=[c.slice(0,r),"\n\t\t",c.slice(r)].join(""));l.length>r&&(l=[l.slice(0,r),"\n\t\t",l.slice(r)].join(""));a.length>r&&(a=[a.slice(0,r),"\n\t\t",a.slice(r)].join(""));t.setFont("arial","normal");t.setFontSize(12);k="Seller : "+i.sellerName+"\n"+("Address : "+c+"\n")+"VAT NO : \n\n"+("Importer : "+i.importerName+"\n")+("Address : "+l+"\n")+"EORI Number : \n\n"+("Delivery Address : "+i.customer+"\n")+("Address : "+a+"\n")+"\n"+("Vat : "+i.vatState+"  "+i.vatNumber+"\n")+("Inco Terms : "+i.incoTerms+"\n")+("Currency : "+i.currencyCode+"\n");t.text(20,80,k);t.setDrawColor(0,0,0);t.setLineWidth(1);t.line(20,310,b-20,310);var d=330,p=20,g=[],nt=o.length;for(u=0;u<nt;u++)g.push({OrderLineNo:o[u].orderLineNo,ProductSKU:o[u].productSKU,CountryOfOrigin:o[u].countryOfOrigin,TariffNumber:o[u].tariffNumber,LinePrice:Math.round(o[u].linePrice*1e3)/1e3,NetWeight:Math.round(o[u].netWeight*1e3)/1e3});for(t.autoTable({startY:d,margin:p,theme:"grid",headStyles:{fillColor:[100,100,100]},body:g,columns:[{header:"OrderLine No",dataKey:"OrderLineNo"},{header:"Product Code/SKU",dataKey:"ProductSKU"},{header:"Country Of Origin",dataKey:"CountryOfOrigin"},{header:"Tariff Number",dataKey:"TariffNumber"},{header:"Line Price",dataKey:"LinePrice"},{header:"Gross Weight",dataKey:"NetWeight"}]}),w=22.5,e=d+(nt+1)*w;e>=y-p;)e=e-y+w+p;t.setPage(t.internal.getNumberOfPages());t.setDrawColor(0,0,0);t.setLineWidth(1);t.line(20,e+20,575,e+20);v=e+40;e+120>y&&(t.addPage(),v=30);tt="Order Number : "+f.orderNumber+"\n"+("Number Of Packages : "+f.numberOfPackages+"\n")+("Total Value : "+Math.round(f.totalValue*1e3)/1e3+"\n")+("Total Gross Weight : "+Math.round(f.totalWeight*1e3)/1e3+"\n")+"\n";t.text(400,v,tt);h=v+100;v+100>y&&(t.addPage(),h=30);var it="Print Name : "+f.printName,rt="Signature : "+f.signature,ut="Position : "+f.position,ft="Date : "+f.date;t.text(20,h,it);t.text(300,h,ut);t.text(20,h+40,rt);t.text(300,h+40,ft);s<n.length-1&&t.addPage()}window.open(t.output("bloburl"),"_blank")}var CurrentTrailerId=null;$("#btn-search-trailer").click(function(){var n=$("#search-trailer-id").val();if(!n){customAlert("Please Input TrailerId");return}searchTrailer(n)});$("#btn-create-trailer").click(function(){$.get("/api/ApiGeneral/CreateNewTrailer",function(n){emptyOrderListTable();var t=n;$("#trailer-id").html(t);CurrentTrailerId=t})});$("#btn-add-order").click(function(){if(CurrentTrailerId==null){customAlert("Please Search Or Create Trailer");return}$("#modal-add-order").modal()});$("#btn-confirm-add-order").click(function(){var n=!0,t;($("#modal-add-order").find("input, select").each(function(){$(this).is(":visible")&&$(this).prop("required")&&($(this).val()==null||$(this).val()==="")?($(this).addClass("is-invalid"),n=!1):$(this).removeClass("is-invalid")}),n)&&($("#modal-add-order").modal("hide"),t=$("#add-order-number").val(),$.get("/api/ApiGeneral/AddOrderToTrailer?TrailerId="+CurrentTrailerId+"&OrderNumber="+t,function(n){n=="Success"?(searchTrailer(CurrentTrailerId),customAlert("Success",!0)):customAlert(n)}))});$("#btn-remove-order").click(function(){if(CurrentTrailerId==null){customAlert("Please Search Or Create Trailer");return}$("#modal-remove-order").modal()});$("#btn-confirm-remove-order").click(function(){var n=!0,t;($("#modal-remove-order").find("input, select").each(function(){$(this).is(":visible")&&$(this).prop("required")&&($(this).val()==null||$(this).val()==="")?($(this).addClass("is-invalid"),n=!1):$(this).removeClass("is-invalid")}),n)&&($("#modal-remove-order").modal("hide"),t=$("#remove-order-number").val(),$.get("/api/ApiGeneral/RemoveOrderFromTrailer?TrailerId="+CurrentTrailerId+"&OrderNumber="+t,function(n){n=="Success"?(searchTrailer(CurrentTrailerId),customAlert("Success",!0)):customAlert(n)}))});$("#btn-create-invoice").click(function(){if(CurrentTrailerId==null){customAlert("Please Search Or Create Trailer");return}$.get("/api/ApiGeneral/CreateCommercialInvoice?TrailerId="+CurrentTrailerId,function(n){if(n.length==0){customAlert("Trailer Is Empty! Plesae Add OrderNumber.");return}GeneratePDFFromInvoice(n)})});